
# 🧾 发票打印助手 (ZZPrinter) v3.5

**一款专为采购、财务、出纳及行政人员设计的发票批处理与自动化台账管理工具。**

本工具支持发票信息的自动提取、A4 纸拼版打印，并能自动生成包含详细明细的电子台账，告别手动录入，极大地提升办公效率。

---

## ✨ 界面预览
![alt text](img/UI.png)
![alt text](img/明细.png)
![alt text](img/明细一级分组.png)
![alt text](img/明细二级分组.png)
![alt text](img/筛选.png)
![alt text](img/台账.png)

## ✨ 核心特性

* **⚡ 智能识别**：自动解析 PDF/OFD 格式发票，提取发票号码、开票日期、销售方信息及**所有商品明细**。
* **🖨️ 省纸拼版**：提供 1×1 到 2×4 多种布局模式，一张 A4 纸最高可打印 8 张发票。
* **📊 深度台账**：
* **处理日期追踪**：自动记录发票的打印处理时间，支持按天或按日期区间（如 `2026-01-01至2026-01-15`）快速筛选。
* **一票多行支持**：完美解析包含多项明细的发票，不再只记录总额。
* **动态汇总**：支持按销售方或发票号码进行一级/二级分组统计，实时计算价税合计。


* **📥 展平式导出**：一键导出 Excel 台账，**所有明细字段独立成列**，方便直接用于财务报表或税务勾选。
* **🌓 双色主题**：内置深色（Dark）与浅色（Light）模式，保护视力。
* **🖱️ 交互便捷**：支持文件/文件夹拖拽导入，重复发票红字提醒。

---

## 🚀 快速开始

### 1. 环境依赖

确保您的电脑已安装 Python 3.8+，并安装以下库：

```bash
pip install PyQt6 PyMuPDF pdfplumber pandas openpyxl

```

### 2. 运行程序

在项目根目录下执行：

```bash
python zzprint.py

```

---

## 🛠️ 功能操作指南

### **台账筛选与汇总**

* **关键词筛选**：在顶部搜索框输入销售方名称，表格会实时更新。
* **日期区间查询**：在“处理日期”框输入 `2026-01-15` 查询当天处理的任务；输入 `2026-01-10至2026-01-15` 查询该时间段内的所有记录。
* **分组统计**：开启“📊 分组统计”按钮，切换“汇总级别”，可查看各供应商的月度或单笔金额小计。

### **导出 Excel**

* 点击“导出 Excel 台账”，程序会将当前**筛选后**的结果导出，如需导出==全部数据==，**重置筛选项**再导出即可。
* 导出的表格已将发票明细“展平”：即如果一张发票有 3 行商品明细，Excel 中将对应 3 行记录，每行包含完整的发票头信息（号码、日期等）及该行明细信息。

---

## 📅 版本更新记录

### v3.5 (2026-01-15)

* **【优化】** 彻底重构 Excel 导出逻辑，实现明细数据全字段独立列展示，取消单元格堆叠。
* **【修复】** 优化了旧版本 `invoice_ledger.json` 数据的向下兼容性。

### v3.4 (2026-01-15)

* **【新增】** 处理日期追踪功能，记录发票打印处理的具体时间。
* **【新增】** 支持处理日期区间筛选（“至”字连接）。
* **【新增】** 表格列布局调整，增加“处理日期”展示。

### v3.3 (2026-01-14)

* **【新增】** “一票多行”解析引擎，支持提取发票内所有的商品明细。
* **【新增】** 一级/二级分组汇总功能。

---

## 📝 注意事项

* **数据安全**：所有发票台账数据均保存在本地 `invoice_ledger.json` 中，请勿随意删除该文件，建议定期备份。
* **文件支持**：对于 OFD 格式，请确保环境已正确安装相关解析组件（本程序优先通过 PyMuPDF 处理）。
* **导出台账**：导出台账时，请确认导出的文件名与之前的不要重复，如需覆盖原导出的文件，请确保该文件没有被打开

---

**💡 提示：** 每次升级代码后，如果遇到报错，通常是因为旧的数据文件格式不兼容，v3.5 已内置自动迁移逻辑，无需手动删档。
